# aws-yet-another-cloudwatch-exporter
# The propose of this moduel is create 2 roles: First for cloud yet another watch exporter and second for assumable role 
<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | ~> 1.9 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | ~> 5.62 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | ~> 5.62 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_assume_policy"></a> [assume\_policy](#module\_assume\_policy) | git::https://github.com/terraform-aws-modules/terraform-aws-iam.git//modules/iam-policy | 02a5b7f35ecdd60498d978166ab2033bbdae5013 |
| <a name="module_assume_role"></a> [assume\_role](#module\_assume\_role) | git::https://github.com/terraform-aws-modules/terraform-aws-iam.git//modules/iam-role-for-service-accounts-eks | 02a5b7f35ecdd60498d978166ab2033bbdae5013 |
| <a name="module_exporter_policy"></a> [exporter\_policy](#module\_exporter\_policy) | git::https://github.com/terraform-aws-modules/terraform-aws-iam.git//modules/iam-policy | 02a5b7f35ecdd60498d978166ab2033bbdae5013 |
| <a name="module_exporter_role"></a> [exporter\_role](#module\_exporter\_role) | git::https://github.com/terraform-aws-modules/terraform-aws-iam.git//modules/iam-assumable-role | 02a5b7f35ecdd60498d978166ab2033bbdae5013 |

## Resources

| Name | Type |
|------|------|
| [aws_iam_policy_document.assume_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_iam_policy_document.exporter_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_assume_policy"></a> [assume\_policy](#input\_assume\_policy) | The role variables for exporter policy | <pre>object({<br>    create_policy      = optional(bool, true)<br>    policy_name_prefix = optional(string, "exporter")<br>    policy_path        = optional(string, "/")<br>    policy_description = optional(string, "The policy for exporter role")<br>    tags               = optional(map(any), {})<br>  })</pre> | `{}` | no |
| <a name="input_assume_role"></a> [assume\_role](#input\_assume\_role) | Variables for assume role | <pre>object({<br>    create_role                   = optional(bool, true)<br>    role_name                     = optional(string, null)<br>    role_path                     = optional(string, "/")<br>    role_permissions_boundary_arn = optional(string, null)<br>    role_description              = optional(string, null)<br>    role_name_prefix              = optional(string, null)<br>    policy_name_prefix            = optional(string, "AmazonEKS_")<br>    role_policy_arns              = optional(map(string), {})<br>    oidc_providers                = optional(any, {})<br>    tags                          = optional(map(any), {})<br>    force_detach_policies         = optional(bool, true)<br>    max_session_duration          = optional(number, null)<br>    assume_role_condition_test    = optional(string, "StringEquals")<br>    allow_self_assume_role        = optional(bool, false)<br>    ################################################################################<br>    # Policies<br>    ################################################################################<br>    attach_aws_gateway_controller_policy = optional(bool, false)<br>    attach_cert_manager_policy           = optional(bool, false)<br>    cert_manager_hosted_zone_arns        = optional(list(string), ["arn:aws:route53:::hostedzone/*"])<br>    attach_cluster_autoscaler_policy     = optional(bool, false)<br>    cluster_autoscaler_cluster_ids       = optional(list(string), [])<br>    cluster_autoscaler_cluster_names     = optional(list(string), [])<br>    attach_ebs_csi_policy                = optional(bool, false)<br>    ebs_csi_kms_cmk_ids                  = optional(list(string), [])<br>    attach_efs_csi_policy                = optional(bool, false)<br>    attach_mountpoint_s3_csi_policy      = optional(bool, false)<br>    mountpoint_s3_csi_bucket_arns        = optional(list(string), [])<br>    mountpoint_s3_csi_kms_arns           = optional(list(string), [])<br>    mountpoint_s3_csi_path_arns          = optional(list(string), [])<br>    attach_external_dns_policy           = optional(bool, false)<br>    external_dns_hosted_zone_arns        = optional(list(string), ["arn:aws:route53:::hostedzone/*"])<br>    # External Secrets<br>    attach_external_secrets_policy                     = optional(bool, false)<br>    external_secrets_ssm_parameter_arns                = optional(list(string), ["arn:aws:ssm:*:*:parameter/*"])<br>    external_secrets_secrets_manager_arns              = optional(list(string), ["arn:aws:secretsmanager:*:*:secret:*"])<br>    external_secrets_kms_key_arns                      = optional(list(string), ["arn:aws:kms:*:*:key/*"])<br>    external_secrets_secrets_manager_create_permission = optional(bool, false)<br>    # FSx Lustre CSI<br>    attach_fsx_lustre_csi_policy     = optional(bool, false)<br>    fsx_lustre_csi_service_role_arns = optional(list(string), ["arn:aws:iam::*:role/aws-service-role/s3.data-source.lustre.fsx.amazonaws.com/*"])<br>    # Karpenter controller<br>    attach_karpenter_controller_policy                              = optional(bool, false)<br>    karpenter_controller_cluster_id                                 = optional(string, "*")<br>    karpenter_controller_cluster_name                               = optional(string, "*")<br>    karpenter_tag_key                                               = optional(string, "karpenter.sh/discovery")<br>    karpenter_controller_ssm_parameter_arns                         = optional(list(string), ["arn:aws:ssm:*:*:parameter/aws/service/*"])<br>    karpenter_controller_node_iam_role_arns                         = optional(list(string), ["*"])<br>    karpenter_subnet_account_id                                     = optional(string, "")<br>    karpenter_sqs_queue_arn                                         = optional(string, null)<br>    enable_karpenter_instance_profile_creation                      = optional(bool, false)<br>    attach_load_balancer_controller_policy                          = optional(bool, false)<br>    attach_load_balancer_controller_targetgroup_binding_only_policy = optional(bool, false)<br>    # AWS Load Balancer Controller<br>    load_balancer_controller_targetgroup_arns = optional(list(string), ["arn:aws:elasticloadbalancing:*:*:targetgroup/*/*"])<br>    attach_appmesh_controller_policy          = optional(bool, false)<br>    # AWS Appmesh envoy proxy<br>    attach_appmesh_envoy_proxy_policy                = optional(bool, false)<br>    attach_amazon_managed_service_prometheus_policy  = optional(bool, false)<br>    amazon_managed_service_prometheus_workspace_arns = optional(list(string), ["*"])<br>    # Velero<br>    attach_velero_policy  = optional(bool, false)<br>    velero_s3_bucket_arns = optional(list(string), ["*"])<br>    # VPC CNI<br>    attach_vpc_cni_policy                   = optional(bool, false)<br>    vpc_cni_enable_cloudwatch_logs          = optional(bool, false)<br>    vpc_cni_enable_ipv4                     = optional(bool, false)<br>    vpc_cni_enable_ipv6                     = optional(bool, false)<br>    attach_node_termination_handler_policy  = optional(bool, false)<br>    node_termination_handler_sqs_queue_arns = optional(list(string), ["*"])<br>    # Amazon CloudWatch Observability<br>    attach_cloudwatch_observability_policy = optional(bool, false)<br>  })</pre> | `{}` | no |
| <a name="input_common"></a> [common](#input\_common) | The common variables | <pre>object({<br>    exporter_assumable_roles = optional(list(string))<br>    tags                     = optional(map(any), {})<br>    assume_role_enabled      = optional(bool, false)<br>    exporter_role_enabled    = optional(bool, false)<br>  })</pre> | `{}` | no |
| <a name="input_exporter_policy"></a> [exporter\_policy](#input\_exporter\_policy) | The role variables for exporter policy | <pre>object({<br>    create_policy      = optional(bool, true)<br>    policy_name_prefix = optional(string, "exporter")<br>    policy_path        = optional(string, "/")<br>    policy_description = optional(string, "The policy for exporter role")<br>    tags               = optional(map(any), {})<br>  })</pre> | `{}` | no |
| <a name="input_exporter_role"></a> [exporter\_role](#input\_exporter\_role) | The role variables for exporter role | <pre>object({<br>    trusted_role_actions              = optional(list(string), ["sts:AssumeRole", "sts:TagSession"])<br>    trusted_role_arns                 = optional(list(string), [])<br>    trusted_role_services             = optional(list(string), [])<br>    mfa_age                           = optional(number, 86400)<br>    max_session_duration              = optional(number, 3600)<br>    create_role                       = optional(bool, true)<br>    create_instance_profile           = optional(bool, false)<br>    role_name                         = optional(string, null)<br>    role_name_prefix                  = optional(string, null)<br>    role_path                         = optional(string, "/")<br>    role_requires_mfa                 = optional(bool, false)<br>    role_permissions_boundary_arn     = optional(string, "")<br>    tags                              = optional(map(string), {})<br>    custom_role_policy_arns           = optional(list(string), [])<br>    custom_role_trust_policy          = optional(string, "")<br>    create_custom_role_trust_policy   = optional(bool, false)<br>    number_of_custom_role_policy_arns = optional(number, null)<br>    inline_policy_statements          = optional(any, [])<br>    admin_role_policy_arn             = optional(string, "arn:aws:iam::aws:policy/AdministratorAccess")<br>    poweruser_role_policy_arn         = optional(string, "arn:aws:iam::aws:policy/PowerUserAccess")<br>    readonly_role_policy_arn          = optional(string, "arn:aws:iam::aws:policy/ReadOnlyAccess")<br>    attach_admin_policy               = optional(bool, false)<br>    attach_poweruser_policy           = optional(bool, false)<br>    attach_readonly_policy            = optional(bool, false)<br>    force_detach_policies             = optional(bool, false)<br>    role_description                  = optional(string, "")<br>    role_sts_externalid               = optional(any, [])<br>    allow_self_assume_role            = optional(bool, false)<br>    role_requires_session_name        = optional(bool, false)<br>    role_session_name                 = optional(list(string), ["$${aws:username}"])<br>  })</pre> | `{}` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_iam_assume_policy_arn"></a> [iam\_assume\_policy\_arn](#output\_iam\_assume\_policy\_arn) | The ARN assigned by AWS to this policy |
| <a name="output_iam_assume_policy_description"></a> [iam\_assume\_policy\_description](#output\_iam\_assume\_policy\_description) | The description of the policy |
| <a name="output_iam_assume_policy_id"></a> [iam\_assume\_policy\_id](#output\_iam\_assume\_policy\_id) | The policy's ID |
| <a name="output_iam_assume_policy_name"></a> [iam\_assume\_policy\_name](#output\_iam\_assume\_policy\_name) | The name of the policy |
| <a name="output_iam_assume_policy_path"></a> [iam\_assume\_policy\_path](#output\_iam\_assume\_policy\_path) | The path of the policy in IAM |
| <a name="output_iam_assume_policy_policy"></a> [iam\_assume\_policy\_policy](#output\_iam\_assume\_policy\_policy) | The policy document |
| <a name="output_iam_assume_role_arn"></a> [iam\_assume\_role\_arn](#output\_iam\_assume\_role\_arn) | ARN of IAM role |
| <a name="output_iam_assume_role_name"></a> [iam\_assume\_role\_name](#output\_iam\_assume\_role\_name) | Name of IAM role |
| <a name="output_iam_assume_role_path"></a> [iam\_assume\_role\_path](#output\_iam\_assume\_role\_path) | Path of IAM role |
| <a name="output_iam_assume_role_unique_id"></a> [iam\_assume\_role\_unique\_id](#output\_iam\_assume\_role\_unique\_id) | Unique ID of IAM role |
| <a name="output_iam_exporter_instance_profile_arn"></a> [iam\_exporter\_instance\_profile\_arn](#output\_iam\_exporter\_instance\_profile\_arn) | ARN of IAM instance profile |
| <a name="output_iam_exporter_instance_profile_id"></a> [iam\_exporter\_instance\_profile\_id](#output\_iam\_exporter\_instance\_profile\_id) | IAM Instance profile's ID. |
| <a name="output_iam_exporter_instance_profile_name"></a> [iam\_exporter\_instance\_profile\_name](#output\_iam\_exporter\_instance\_profile\_name) | Name of IAM instance profile |
| <a name="output_iam_exporter_instance_profile_path"></a> [iam\_exporter\_instance\_profile\_path](#output\_iam\_exporter\_instance\_profile\_path) | Path of IAM instance profile |
| <a name="output_iam_exporter_policy_arn"></a> [iam\_exporter\_policy\_arn](#output\_iam\_exporter\_policy\_arn) | The ARN assigned by AWS to this policy |
| <a name="output_iam_exporter_policy_description"></a> [iam\_exporter\_policy\_description](#output\_iam\_exporter\_policy\_description) | The description of the policy |
| <a name="output_iam_exporter_policy_id"></a> [iam\_exporter\_policy\_id](#output\_iam\_exporter\_policy\_id) | The policy's ID |
| <a name="output_iam_exporter_policy_name"></a> [iam\_exporter\_policy\_name](#output\_iam\_exporter\_policy\_name) | The name of the policy |
| <a name="output_iam_exporter_policy_path"></a> [iam\_exporter\_policy\_path](#output\_iam\_exporter\_policy\_path) | The path of the policy in IAM |
| <a name="output_iam_exporter_policy_policy"></a> [iam\_exporter\_policy\_policy](#output\_iam\_exporter\_policy\_policy) | The policy document |
| <a name="output_iam_exporter_requires_mfa"></a> [iam\_exporter\_requires\_mfa](#output\_iam\_exporter\_requires\_mfa) | Whether IAM role requires MFA |
| <a name="output_iam_exporter_role_arn"></a> [iam\_exporter\_role\_arn](#output\_iam\_exporter\_role\_arn) | ARN of IAM role |
| <a name="output_iam_exporter_role_name"></a> [iam\_exporter\_role\_name](#output\_iam\_exporter\_role\_name) | Name of IAM role |
| <a name="output_iam_exporter_role_path"></a> [iam\_exporter\_role\_path](#output\_iam\_exporter\_role\_path) | Path of IAM role |
| <a name="output_iam_exporter_role_unique_id"></a> [iam\_exporter\_role\_unique\_id](#output\_iam\_exporter\_role\_unique\_id) | Unique ID of IAM role |
| <a name="output_iam_exporter_sts_externalid"></a> [iam\_exporter\_sts\_externalid](#output\_iam\_exporter\_sts\_externalid) | STS ExternalId condition value to use with a role |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
